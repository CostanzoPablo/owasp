<?php
if (!isset($_GET["data"])){
include('../header.php');
echo '<ul class="help-box">
	<li class="info-box"><b>Wiki:</b><br>
		<div><a target="_blank" href="https://es.wikipedia.org/wiki/Cross-site_scripting">XSS</a></div>
	</li>
	<li class="info-box"><b>Tip:</b><br>
		You can send comments, as in many forums. Try to make your comment stand out from the rest, having colors.
	</li>
	<li class="info-box" id="info-code" onclick="swapViewCode();"><pre>';
	$sourceCode = file_get_contents('index.php');
	$sourceCode = str_replace('0b1d3c2df39cfc31143e2b8d0e7e559e', 'XXX', $sourceCode);
	echo htmlentities($sourceCode);
	echo '</pre></li>
</ul>';
}
//XSS
	//permitir postear codigo y ese codigo tiene codigo JS que hace que las visitas sean redireccionadas
include('../connect.php');

$_GET = str_replace("'", '', $_GET);
$_POST = str_replace("'", '', $_POST);

if (!empty($_SERVER['HTTP_CLIENT_IP'])) {
    $ip = $_SERVER['HTTP_CLIENT_IP'];
} elseif (!empty($_SERVER['HTTP_X_FORWARDED_FOR'])) {
    $ip = $_SERVER['HTTP_X_FORWARDED_FOR'];
} else {
    $ip = $_SERVER['REMOTE_ADDR'];
}



if (isset($_POST["comment"])){
	$comment = str_replace('<script', '', $_POST["comment"]);
	if ($comment != str_replace('<font color=', '', $_POST["comment"]) AND $comment != str_replace('</font>', '', $_POST["comment"])){
		echo 'Flag Unlocked: 0b1d3c2df39cfc31143e2b8d0e7e559e';
	}
	$sql=("INSERT INTO owasp_3_comments (comment) VALUES ('$comment')");
	if (!mysqli_query($con, $sql)){
		die('error');
	}	
}

echo '<br><br>Send new comment:
<form method="post" action="./index.php">
	<input type="text" name="comment" value="" placeholder="Your comments...">
	<input type="submit" value="SEND">
</form>';

echo '<br><br>Comments:';
$sql=mysqli_query($con, "SELECT * FROM owasp_3_comments");
while($row = mysqli_fetch_array($sql)){
	echo '<hr>
	'.$row["comment"];
}

?>